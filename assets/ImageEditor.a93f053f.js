import{P as e,f as t,r as n,D as s,a8 as a,a4 as o,aW as r,ag as i,ae as l,al as u,ad as c,E as m,N as d,F as p,aj as h,aV as f,aF as v,M as y}from"./index.e4c0768c.js";import{l as x,a as w,d as M,b as E,c as g}from"./mosaic.20906289.js";let b=null;function C(e=document.getElementsByTagName("head")[0]){let t=document.createElement("style");return t.media="screen",e.appendChild(t),t}function R(e,t,n=function(){return null!=b?b:b=C()}()){n&&t&&n.sheet.insertRule(e+"{"+t+"}",0)}const z=[{position:["top"],cursor:"ns-resize"},{position:["bottom"],cursor:"ns-resize"},{position:["left"],cursor:"ew-resize"},{position:["right"],cursor:"ew-resize"},{position:["top","left"],cursor:"nwse-resize"},{position:["bottom","right"],cursor:"nwse-resize"},{position:["top","right"],cursor:"nesw-resize"},{position:["bottom","left"],cursor:"nesw-resize"}];var I=e({name:"ImageEditor",setup(){const e=t(null),i=t(null),l=n({x:0,y:0,h:0,w:0});let u=null,c=null,m=x.cloneDeep(l);const d={x:{min:0,max:0},y:{min:0,max:0}};let p=[],h=null;const f=s((()=>{const{x:e,y:t,h:n,w:s}=l,[a,o,r,i]=[e,t,n,s].map((e=>`${e}px`)),u={left:a,top:o,height:r,width:i,border:"0"};return n>0&&s>0&&(u.border="1px solid skyblue"),u}));function v(){var t;if(!e.value)return;g(e.value,i.value.querySelector("img")),null==(t=i.value)||t.requestFullscreen();const{width:n,height:s}=e.value;d.x.max=n,d.y.max=s}function y(e){e.target.classList[document.fullscreenElement?"add":"remove"]("fullscreen")}function b(e){m=x.cloneDeep(l),e.stopImmediatePropagation();const{x:t,y:n}=e;c={x:t,y:n},document.addEventListener("mousemove",I),document.addEventListener("mouseup",k),document.onselectstart=()=>!1}function I(e){if(!c||!u)return;const{x:t,y:n}=c,{x:s,y:a}=e,[o,r]=[s-t,a-n];switch(u){case"CREATE":l.w=Math.abs(o),l.h=Math.abs(r),l.x=Math.min(t,s),l.y=Math.min(n,a);break;case"MOVE":{const{x:e,y:t}=m,{h:n,w:s}=l;l.x=Math.min(Math.max(e+o,d.x.min),d.x.max-s),l.y=Math.min(Math.max(t+r,d.y.min),d.y.max-n);break}case"RESIZE":{const{h:e,y:t,w:n,x:o}=m;p.includes("top")?(l.y=Math.min(a,t+e),l.h=Math.abs(t-a+e)):p.includes("bottom")&&(l.y=Math.min(a,t),l.h=Math.abs(a-t)),p.includes("left")?(l.x=Math.min(s,o+n),l.w=Math.abs(o-s+n)):p.includes("right")&&(l.x=Math.min(s,o),l.w=Math.abs(s-o))}}}function k(e){var t;c=null,document.onselectstart=null,null==(t=null==h?void 0:h.parentNode)||t.removeChild(h),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",k)}return a((()=>{var e;null==(e=i.value)||e.addEventListener("fullscreenchange",y)})),o((()=>{var e;null==(e=i.value)||e.removeEventListener("fullscreenchange",y)})),{openFile:function(){w().then((t=>{const{width:n,height:s}=screen;M(e.value,t,{width:n,height:s}),v()}))},downloadImage:function(){E(e.value),r.info("文件已开始下载")},requestFullscreen:v,startCapture:function(e){const{x:t,y:n}=e;Object.assign(l,{x:t,y:n}),u="CREATE",R("*","cursor: crosshair !important;",h=C()),b(e)},startMove:function(e){u="MOVE",R("*","cursor: move !important;",h=C()),b(e)},startResize:function(e,{position:t,cursor:n}){u="RESIZE",p=t,R("*",`cursor: ${n} !important;`,h=C()),b(e)},captureLayerStyle:f,RESIZE_POINTS:z,canvasRef:e,wrapRef:i}}});const k=v("data-v-136cbf4d");i("data-v-136cbf4d");const _=y("选择图片"),L=y("下载图片"),S=y("全屏"),F=d("img",{src:"/assets/test.c4dae957.png",alt:"",style:{display:"none"}},null,-1),O={ref:"canvasRef",width:"400",height:"400"};l();const j=k(((e,t,n,s,a,o)=>{const r=u("el-button"),i=u("el-tooltip"),l=u("el-form-item"),v=u("el-form");return c(),m(p,null,[d(v,{inline:!0,size:"mini"},{default:k((()=>[d(l,null,{default:k((()=>[d(i,{content:"选择图片后会进入全屏操作"},{default:k((()=>[d(r,{type:"primary",onClick:e.openFile},{default:k((()=>[_])),_:1},8,["onClick"])])),_:1}),d(r,{type:"primary",onClick:e.downloadImage},{default:k((()=>[L])),_:1},8,["onClick"]),d(r,{type:"primary",onClick:e.requestFullscreen},{default:k((()=>[S])),_:1},8,["onClick"])])),_:1})])),_:1}),d("div",{class:"wrapper",ref:"wrapRef",onMousedownOnce:t[2]||(t[2]=(...t)=>e.startCapture&&e.startCapture(...t))},[F,d("canvas",O,null,512),d("div",{class:"capture-layer",style:e.captureLayerStyle,onMousedown:t[1]||(t[1]=(...t)=>e.startMove&&e.startMove(...t))},[(c(!0),m(p,null,h(e.RESIZE_POINTS,(t=>(c(),m("i",{onMousedown:f((n=>e.startResize(n,t)),["prevent"]),key:t.position.join(),style:t.position.reduce(((e,t)=>Object.assign(e,{[t]:"-3px"})),{cursor:t.cursor}),class:"resize-point"},null,44,["onMousedown"])))),128))],36)],544)],64)}));I.render=j,I.__scopeId="data-v-136cbf4d";export default I;
